var b=Object.defineProperty;var v=(h,e,t)=>e in h?b(h,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):h[e]=t;var n=(h,e,t)=>(v(h,typeof e!="symbol"?e+"":e,t),t);import{W as k,S as L,P as K,C,V as A,G as I,M as y,A as E,I as d,B as c,a as r,b as m,c as u,d as S,T as Y,O as D,e as z,D as V,f as H,g as R}from"./vendor.js";const P=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerpolicy&&(i.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?i.credentials="include":s.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}};P();class G{constructor(e=60,t=1.333,a=1,s=1e3){n(this,"aspectRatio");n(this,"fov");n(this,"znear");n(this,"zfar");n(this,"renderer");n(this,"scene");n(this,"camera");n(this,"clock");this.fov=e,this.aspectRatio=t,this.znear=a,this.zfar=s,this.renderer=new k,this.renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(this.renderer.domElement),this.resize(),window.addEventListener("resize",()=>{this.resize()},!1),window.addEventListener("mousedown",i=>{this.onMouseDown(i)}),window.addEventListener("mouseup",i=>{this.onMouseUp(i)}),window.addEventListener("mousemove",i=>{this.onMouseMove(i)}),window.addEventListener("wheel",i=>{this.onMouseWheel(i)}),window.addEventListener("keydown",i=>{this.onKeyDown(i)}),window.addEventListener("keyup",i=>{this.onKeyUp(i)}),this.scene=new L,this.camera=new K(this.fov,this.aspectRatio,this.znear,this.zfar),this.clock=new C}start(){this.createScene(),this.mainLoop()}mainLoop(){this.update(this.clock.getDelta()),this.renderer.render(this.scene,this.camera),window.requestAnimationFrame(()=>this.mainLoop())}resize(){this.renderer.setSize(window.innerWidth,window.innerHeight);var e=new A;this.renderer.getViewport(e);var t=window.innerWidth/window.innerHeight;this.aspectRatio>t?this.renderer.setViewport(0,(window.innerHeight-window.innerWidth/this.aspectRatio)/2,window.innerWidth,window.innerWidth/this.aspectRatio):this.renderer.setViewport((window.innerWidth-window.innerHeight*this.aspectRatio)/2,0,window.innerHeight*this.aspectRatio,window.innerHeight)}onMouseDown(e){}onMouseUp(e){}onMouseMove(e){}onMouseWheel(e){}onKeyDown(e){}onKeyUp(e){}}class o extends I{constructor(e,t){super();n(this,"name");n(this,"chain");n(this,"boneLength");n(this,"boneId");n(this,"defaultMaterial");n(this,"debugHelper");this.name=e,this.defaultMaterial=new y,this.defaultMaterial.wireframe=!1,this.debugHelper=new E(.07),this.debugHelper.visible=!1,this.add(this.debugHelper),this.chain=t,this.boneId=-1,this.boneLength=0}createSkeleton(){if(new d.V3,this.name=="root")this.add(new o("upperArm",this.chain));else if(this.name=="upperArm"){this.add(new o("middleArm",this.chain)),this.boneLength=.5;const e=new d.Bone3D(new d.V3(0,.05,0),void 0,new d.V3(0,1,0),this.boneLength);this.chain.addBone(e),this.boneId=this.chain.bones.length-1}else this.name=="middleArm"?(this.add(new o("lowerArm",this.chain)),this.boneLength=.4,this.chain.addConsecutiveBone(new d.V3(0,1,0),this.boneLength),this.boneId=this.chain.bones.length-1):this.name=="lowerArm"?(this.add(new o("endEffector",this.chain)),this.boneLength=.4,this.chain.addConsecutiveBone(new d.V3(0,1,0),this.boneLength),this.boneId=this.chain.bones.length-1):this.name=="endEffector"&&(this.boneLength=.2,this.chain.addConsecutiveBone(new d.V3(0,1,0),this.boneLength),this.boneId=this.chain.bones.length-1);this.children.forEach(e=>{e instanceof o&&e.createSkeleton()})}createMeshes(){if(this.name=="root"){const e=new c(.5,.05,.5),t=new r(e,this.defaultMaterial);t.translateY(.025),this.add(t);const a=new m(.1,16,6,0,Math.PI*2,0,Math.PI/2),s=new r(a,this.defaultMaterial);s.translateY(.05),this.add(s)}if(this.name=="upperArm"){const e=new c(.05,this.boneLength,.05),t=new r(e,this.defaultMaterial);t.translateY(.25),this.add(t);const a=new m(.05),s=new r(a,this.defaultMaterial);s.translateY(.5),this.add(s)}else if(this.name=="middleArm"){this.translateY(.5),this.rotateZ(45*Math.PI/180);const e=new c(.05,this.boneLength,.05),t=new r(e,this.defaultMaterial);t.translateY(.2),this.add(t);const a=new m(.05),s=new r(a,this.defaultMaterial);s.translateY(.4),this.add(s)}else if(this.name=="lowerArm"){this.translateY(.4),this.rotateZ(45*Math.PI/180);const e=new c(.05,this.boneLength,.05),t=new r(e,this.defaultMaterial);t.translateY(.2),this.add(t);const a=new m(.05),s=new r(a,this.defaultMaterial);s.translateY(.4),this.add(s)}else if(this.name=="endEffector"){this.translateY(.4),this.rotateZ(45*Math.PI/180),this.rotateY(90*Math.PI/180);const e=this.boneLength/1.5,t=new c(.025,e,.025),a=new r(t,this.defaultMaterial);a.rotateZ(45*Math.PI/180),a.translateY(this.boneLength/4+.04),this.add(a);const s=new r(t,this.defaultMaterial);s.translateY(e/2),s.rotateZ(-75*Math.PI/180),s.translateY(e/2-.01225),a.add(s);const i=new r(t,this.defaultMaterial);i.rotateZ(-45*Math.PI/180),i.translateY(e/2+.04),this.add(i);const l=new r(t,this.defaultMaterial);l.translateY(e/2),l.rotateZ(75*Math.PI/180),l.translateY(e/2-.01225),i.add(l)}this.children.forEach(e=>{e instanceof o&&e.createMeshes()})}update(){if(this.boneId>=0){const e=this.chain.bones[this.boneId];this.lookAt(e.end.x,e.end.y,e.end.z),this.rotateX(Math.PI/2)}this.children.forEach(e=>{e instanceof o&&e.update()})}setRotation(e,t){this.name==e?this.setRotationFromEuler(t):this.children.forEach(a=>{a instanceof o&&a.setRotation(e,t)})}setDebugMode(e){this.defaultMaterial.wireframe=e,this.debugHelper.visible=e,this.children.forEach(t=>{t instanceof o&&t.setDebugMode(e)})}}class f{constructor(e=0,t=new u){n(this,"timestamp");n(this,"position");this.timestamp=e,this.position=new u,this.position.copy(t)}}class O{constructor(e){n(this,"animatedObject");n(this,"keyframes");n(this,"curve");n(this,"curveKeyframes");n(this,"curveFps");n(this,"playing");n(this,"currentTime");n(this,"currentKeyframe");this.animatedObject=e,this.keyframes=[],this.keyframes.push(new f),this.curve=new S,this.curve.points.push(new u),this.curveKeyframes=[],this.curveFps=30,this.currentTime=0,this.currentKeyframe=0,this.playing=!1}addKeyframe(e){const t=e.clone(),a=new f(this.keyframes[this.keyframes.length-1].timestamp+1,t);this.keyframes.push(a),this.curve.points.push(t)}play(){if(this.keyframes.length<=1){console.log("No animation to play.  Please add a keyframe.");return}if(this.keyframes[0].position.copy(this.animatedObject.position),this.curve.points[0].copy(this.animatedObject.position),this.keyframes.length>=3){const e=this.keyframes[this.keyframes.length-1].timestamp,t=Math.ceil(this.curveFps*e),a=this.curve.getPoints(t);this.curveKeyframes=[];for(let s=0;s<a.length;s++)this.curveKeyframes.push(new f(s*(e/t),a[s]))}else console.log("Insufficient frames to generate a curve; only linear interpolation will be available.");this.currentTime=0,this.currentKeyframe=1,this.playing=!0}stop(){this.playing=!1}update(e,t=!0){this.playing&&(this.currentTime+=e,this.currentTime<=this.keyframes[this.currentKeyframe].timestamp?t&&this.keyframes.length>=3?this.lerpCurveKeyframes():this.lerpKeyframe():this.currentKeyframe<this.keyframes.length-1?(this.currentKeyframe++,t&&this.keyframes.length>=3?this.lerpCurveKeyframes():this.lerpKeyframe()):this.playing=!1)}lerpKeyframe(){const e=(this.currentTime-this.keyframes[this.currentKeyframe-1].timestamp)/(this.keyframes[this.currentKeyframe].timestamp-this.keyframes[this.currentKeyframe-1].timestamp);this.animatedObject.position.lerpVectors(this.keyframes[this.currentKeyframe-1].position,this.keyframes[this.currentKeyframe].position,e)}lerpCurveKeyframes(){const e=Math.ceil(this.currentTime*this.curveFps),t=(this.currentTime-this.curveKeyframes[e-1].timestamp)/(this.curveKeyframes[e].timestamp-this.curveKeyframes[e-1].timestamp);this.animatedObject.position.lerpVectors(this.curveKeyframes[e-1].position,this.curveKeyframes[e].position,t)}}class B extends G{constructor(){super(60,1920/1080,.1,10);n(this,"debugMode");n(this,"motionMode");n(this,"robotRoot");n(this,"robotChain");n(this,"ikSolver");n(this,"targetMesh");n(this,"transformControls");n(this,"animation");this.debugMode=!1,this.motionMode="Linear",this.ikSolver=new d.Structure3D,this.robotChain=new d.Chain3D,this.robotRoot=new o("root",this.robotChain),this.transformControls=new Y(this.camera,this.renderer.domElement),this.targetMesh=new r,this.animation=new O(this.targetMesh)}createScene(){this.camera.position.set(0,0,1.5),this.camera.lookAt(0,0,0),this.camera.up.set(0,1,0);const e=new D(this.camera,this.renderer.domElement),t=new z("white",.3);this.scene.add(t);const a=new V("white",.6);a.position.set(0,2,1),this.scene.add(a);const s=new H,i=s.addFolder("Animation");i.open(),i.add(this,"motionMode",["Linear","Spline"]).name("Motion"),i.add(this,"addKeyframe").name("Add Keyframe"),i.add(this,"playAnimation").name("Play Animation");const p=s.addFolder("Debugging");p.open();const w=p.add(this,"debugMode");w.name("Debug Mode"),w.onChange(M=>{this.toggleDebugMode(M)}),this.targetMesh.geometry=new m(.02),this.targetMesh.material=new y({color:"skyblue"}),this.targetMesh.position.set(.5,0,-.5),this.scene.add(this.targetMesh),this.transformControls.setSize(.5),this.transformControls.attach(this.targetMesh),this.transformControls.addEventListener("mouseDown",()=>{e.enabled=!1}),this.transformControls.addEventListener("mouseUp",()=>{e.enabled=!0}),this.scene.add(this.transformControls);const g=new R(10,10);this.scene.add(g),g.translateY(-.6),this.robotRoot.createSkeleton(),this.robotRoot.createMeshes(),this.ikSolver.add(this.robotChain,new d.V3(this.targetMesh.position.x,this.targetMesh.position.y,this.targetMesh.position.z)),this.robotRoot.translateY(-.6),this.scene.add(this.robotRoot)}update(e){this.animation.update(e,this.motionMode=="Spline"),this.transformControls.visible=!this.animation.playing,this.targetMesh.visible=!this.animation.playing,this.ikSolver.targets[0].set(this.targetMesh.position.x,this.targetMesh.position.y,this.targetMesh.position.z),this.ikSolver.update(),this.robotRoot.update()}toggleDebugMode(e){this.robotRoot.setDebugMode(e)}addKeyframe(){this.animation.addKeyframe(this.targetMesh.position)}playAnimation(){this.animation.play()}}var T=new B;T.start();
